var Fe=Object.defineProperty;var Ve=(a,b,S)=>b in a?Fe(a,b,{enumerable:!0,configurable:!0,writable:!0,value:S}):a[b]=S;var P=(a,b,S)=>Ve(a,typeof b!="symbol"?b+"":b,S);(function(){"use strict";var a=typeof document<"u"?document.currentScript:null;webix.protoUI({name:"formtable",$allowsClear:!0,setValue:function(s){this.clearAll(),s&&this.parse(s)},getValue:function(){return this.serialize()}},webix.ui.datatable);function b(){let s="",e=2589;const t=document.getElementById("ApiServerIpPort");t!=null&&(e=t.value),s=`http://${window.location.hostname}:${e}/api`;var i=webix.ajax();webix.proxy.api={$proxy:!0,init:o=>{},load:(o,r)=>{if(s=="")return webix.message("Служба не настроена - не указан порт сервера api. Настройте и перезапустите ее."),[];o.disable();var n=o.config.url.source;return i.get(`${s}${n}`).then(l=>{var f=l.json();return f.isSuccess!=null&&(f.isSuccess||webix.message(f.message)),o.enable(),f.content},l=>{o.enable(),webix.message(l)})},save:(o,r)=>{if(s=="")return webix.message("Служба не настроена - не указан порт сервера api. Настройте и перезапустите ее."),[];o.disable(),o.config.url.source}}}class S{constructor(){this.currentPage="",this.routes=new Map}register(e,t){this.routes.set(e,t)}async navigate(e,t){if(e===this.currentPage)return;const i=this.routes.get(e);if(i)try{const o=await i();webix.ui(o(t),$$(t)),$$(t).show(),this.currentPage=e}catch(o){console.error("Ошибка при навигации:",o)}}}const B=s=>({container:"app",type:"space",id:"root",responsive:!0,...s}),k=s=>({view:"toolbar",padding:5,height:60,elements:[{view:"label",id:"toolbarLabel",label:s}]}),O=(s,e)=>({view:"sidebar",id:"sidebar",width:200,collapsed:!1,data:s,on:{onAfterSelect:e}}),N={MONITOR:{id:"monitorView",value:"Мониторинг"},CONFIG:{id:"config",value:"Настройка"},CDN:{id:"cdnListInfo",value:"Список CDN"},MARKS:{id:"marksView",value:"Марки"},LOGS:{id:"logsView",value:"Логи"},INFO:{id:"information",value:"Информация"}},ze="modulepreload",je=function(s,e){return new URL(s,e).href},Ge={},h=function(e,t,i){let o=Promise.resolve();function r(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return o.then(n=>{for(const l of n||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};function I(s){const e=$$(s);let t=JSON.stringify(e.getValues());e.disable(),webix.ajax().post("api/configuration/parameters",t).then(i=>{let o=i.json();if(!o.isSuccess){webix.message(o);return}var r=o.needToRestart;r&&webix.message("Изменения будут применены после перезапуска службы DS:Fmu-Api (она произойдет в течение одной минуты)")}).finally(i=>{e.enable()})}const C={serverConfigData:()=>h(()=>Promise.resolve().then(()=>K),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),salesControl:()=>h(()=>Promise.resolve().then(()=>Q),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),minimalPrices:()=>h(()=>Promise.resolve().then(()=>se),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),organizationsTable:()=>h(()=>Promise.resolve().then(()=>re),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),pingHosts:()=>h(()=>Promise.resolve().then(()=>le),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),databaseConnection:()=>h(()=>Promise.resolve().then(()=>ge),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),frontolDbConnection:()=>h(()=>Promise.resolve().then(()=>Ee),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),markUnit:()=>h(()=>Promise.resolve().then(()=>ve),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),tokenServiceData:()=>h(()=>Promise.resolve().then(()=>$e),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),timeoutConfig:()=>h(()=>Promise.resolve().then(()=>ke),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),loggingConfigData:()=>h(()=>Promise.resolve().then(()=>Re),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href),autoUpdateData:()=>h(()=>Promise.resolve().then(()=>ye),void 0,a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("index.js",document.baseURI).href)};function R(s){$$("toolbarLabel").setValue("FMU-API: Настройка службы");let e=null,t=!1;return{id:s,view:"form",complexData:!0,hidden:!0,borderless:!0,rows:[{cols:[{id:"saveConfigurationButton",view:"button",value:"Сохранить",autowidth:!1,width:120,hidden:!0,click:function(){I(s)}},{}]},{id:"settingsScroll",view:"scrollview",scroll:"y",body:{rows:[]}}],on:{onViewShow:async function(){t=!0;const i=$$(s),o=$$("settingsScroll").getBody();webix.extend($$(s),webix.ProgressBar);try{i.showProgress({type:"icon"}),e=new AbortController;const r=await webix.ajax().get("api/configuration/parameters",{signal:e.signal});if(!t)return;const n=r.json().content;for(const l of Object.keys(C)){const E=(await C[l]()).default(l,n);o.addView(E)}$$("saveConfigurationButton").show()}catch(r){if(r.name==="AbortError"){console.log("Загрузка настроек отменена");return}t&&webix.message({type:"error",text:"Ошибка загрузки настроек"}),console.error("Ошибка загрузки настроек:",r)}finally{t&&i.hideProgress()}},onDestruct:function(){e&&(e.abort(),e=null)}}}}function _(s=""){let e=document.getElementById("ApiServerIpPort");if(e==null)return"";let t=e.value;return`http://${window.location.hostname}:${t}/api${s}`}function D(s){return $$("toolbarLabel").setValue("FMU-API: Информация о системе"),{id:s,rows:[{view:"form",on:{onViewShow:M()},elements:[{view:"label",id:"appVersion",label:"Версия загружается..."},{view:"label",id:"lDatabaseEngineInfo",label:'Для работы fmu-api необходимо скачать и установить базу данных <a href="https://couchdb.apache.org" target="_blank" style="color: red">Apache CouchDb.</a>'},{view:"label",id:"browserRecommendation",label:"Для работы рекомендуется использовать браузер Vivaldi, Edge, Opera, Chrome - в общем все на базе Chromium."},{view:"label",id:"swaggerLink",label:'<a href="scalar/v1" target="_blank" style="color: red">Консоль запросов swagger.</a>.'},{}]}]}}function M(){webix.ajax().get(_("/configuration/about")).then(function(s){var e=s.text();$$("appVersion").setValue(e)})}function y(s){return $$("toolbarLabel").setValue("FMU-API: Список cdn-серверов"),{view:"datatable",id:s,columns:[{id:"host",header:"Хост",fillspace:!0},{id:"latency",header:"Задержка"},{id:"offline",header:"Оффлайн"}],scroll:!1,on:{onBeforeLoad:function(){this.showOverlay("Загружаю...")},onAfterLoad:function(){this.hideOverlay()}},url:function(e){return webix.ajax(_("/configuration/cdn"))}}}class x{constructor(e){this.formName="LogsView",this.id=e,this.LABELS={formTitle:"FMU-API: Логи работы",title:"Просмотр логов",logFile:"Лог работы:",refresh:"Обновить",save:"Сохранить",downloadAll:"Выгрузить все логи",close:"Закрыть",fileDescription:"Текстовый файл",errorDownload:"Ошибка при выгрузке логов",errorLoad:"Ошибка при загрузке логов"},this.NAMES={toolbarLabel:"toolbarLabel",logFiles:"logFiles",refreshLogBtn:"refreshLogBtn",uploadLogBtn:"uploadLogBtn",log:"log"}}render(){$$(this.NAMES.toolbarLabel).setValue(this.LABELS.formTitle);var e=[this._logToolbar(),this._logTextArea()],t={view:"form",id:this.id,name:this.formName,disabled:!0,on:{onViewShow:this._loadLogs("",this.id)},elements:e};return t}_logToolbar(){return{cols:[this._logsCombo(),this._refreshButton(),this._uploadLogButton()]}}_logsCombo(){return{view:"combo",id:this.NAMES.logFiles,label:this.LABELS.logFile,labelWidth:100,newvalues:!1,options:[],on:{onChange:e=>{this._loadLogs(e,this.id)}}}}_refreshButton(){return{view:"button",value:this.LABELS.refresh,id:this.NAMES.refreshLogBtn,autowidth:"false",width:400,click:async e=>{var t=$$(this.NAMES.logFiles),i=t.getValue();i&&i!=""&&this._loadLogs(i,this.id)}}}_uploadLogButton(){return{view:"button",value:this.LABELS.save,id:this.NAMES.uploadLogBtn,autowidth:"false",width:400,click:async e=>{var t=$$(this.NAMES.log),i=await this._getNewFileHandle();await this._writeTextFile(i,t.getValue())}}}_logTextArea(){return{view:"textarea",id:this.NAMES.log,readonly:!0}}_loadLogs(e,t){$$(t).disable(),e=e.length==0?"now":e,webix.ajax().get(_(`/configuration/logs/${e}`)).then(i=>{var o=i.json(),r=$$(this.NAMES.logFiles);r.blockEvent();var n=r.getPopup().getList();n.clearAll(),n.parse(o.fileNames),r.setValue(o.selectedFile),r.unblockEvent();var l=$$(this.NAMES.log);const f=o.log.split(`
`).reverse().join(`
`);l.setValue(f),$$(t).enable()})}async _getNewFileHandle(){const e={types:[{keepExistingData:!1,description:"Текстовый файл",accept:{"text/plain":[".txt"]}}]};return await window.showSaveFilePicker(e)}async _writeTextFile(e,t){const i=await e.createWritable(),o=t.split(`
`).reverse().join(`
`);await i.write(o),await i.close()}}function U(s){return new x(s).render()}class F{constructor(e){this.formName="MonitorView",this.id=e,this.monitoringApiAddress="/api/monitoring/systemstate",this.POLL_INTERVAL=1e4,this.LABELS={formTitle:"FMU-API: Мониторинг",dbStatus:"Статус базы данных: ",dbStatusOnline:"On-line",dbStatusOffline:"Off-line",dbStatusDisabled:"Disabled",dbStatusUnknown:"Неизвестно",localModules:"Локальные модули",lastSync:"Последняя синхронизация",version:"Версия",status:"Статус",url:"Адрес модуля",checkStatistics:"Статистика проверок",totalChecks:"Всего проверок",successfulOnlineChecks:"Онлайн",successfulOfflineChecks:"Офлайн",successRatePercentage:"Успешно(%)",today:"Сегодня",last7Days:"Последние 7 дней",last30Days:"Последние 30 дней",period:"Период",checkStatisticsLabel:"Статистика проверок"},this.NAMES={toolbarLabel:"toolbarLabel",dbStatus:"dbStatus",localModulesTable:"localModulesTable",checkStatisticsTable:"checkStatisticsTable",checkStatisticsTableLabel:"checkStatisticsTableLabel"},this._startLocalMonitoringPolling()}loadConfig(){return this.CouchDbOnLine="Off-line",this}render(){$$("toolbarLabel").setValue(this.LABELS.formTitle);var e=[{view:"label",id:"dbStatus",label:this.LABELS.dbStatus+this.LABELS.dbStatusUnknown},{view:"label",label:this.LABELS.localModules},this._localModules(),{view:"label",id:this.NAMES.checkStatisticsTableLabel,label:this.LABELS.checkStatisticsLabel},this._checkStatistics(),{}],t={view:"form",id:this.id,name:this.formName,disabled:!1,elements:e};return t}_localModules(){return{id:this.NAMES.localModulesTable,view:"datatable",columns:[{id:"url",header:this.LABELS.url,fillspace:!0,sort:"string"},{id:"version",header:this.LABELS.version,width:150,sort:"string"},{id:"lastSyncDateTime",header:this.LABELS.lastSync,width:300,sort:"date",format:function(e){const t=new Date(e);return t.getFullYear()<=1970?"Нет данных":t.toLocaleString()}},{id:"status",header:this.LABELS.status,width:120,sort:"string",template:function(e){var t=e.isReady?"#00BFFF":"#ff0000";return`<span style="color: ${t};">${e.status||"Нет данных"}</span>`}}],autoheight:!0,scroll:!1,select:!1,data:[]}}_checkStatistics(){return{id:this.NAMES.checkStatisticsTable,view:"datatable",columns:[{id:"period",header:this.LABELS.period,sort:"string",fillspace:!0},{id:"totalChecks",header:this.LABELS.totalChecks,sort:"number"},{id:"successfulOnline",header:this.LABELS.successfulOnlineChecks,sort:"date"},{id:"successfulOffline",header:this.LABELS.successfulOfflineChecks,sort:"date"},{id:"successRate",header:this.LABELS.successRatePercentage,sort:"date"},{}],autoheight:!0,scroll:!1,select:!1,data:[]}}_startLocalMonitoringPolling(){const e=this.POLL_INTERVAL,t=async()=>{try{const o=await fetch(this.monitoringApiAddress);if(!o.ok)throw new Error(`Ошибка получения данных мониторинга ${o.status}`);const r=await o.json();this._updateDbState(r.couchDbOnLine),this._updateLocalModulesInformation(r.localeModulesInformation),this._updateCheckStatistics(r.checkStatistics,r.couchDbOnLine)}catch(o){if(o.name==="TypeError"||o.message.includes("fetch")||o.message.includes("Failed to fetch")||o.message.includes("NetworkError")||o.message.includes("ERR_CONNECTION_REFUSED"))return;console.error("Ошибка при получении данных о состоянии сервиса:",o)}};t();const i=setInterval(t,e);this.on_destroy=()=>{clearInterval(i)}}_updateDbState(e){const t=$$(this.NAMES.dbStatus);t&&(e=="Disabled"?t.setValue(this.LABELS.dbStatus+`<span style="color: #FFFFFF;">${this.LABELS.dbStatusDisabled}</span>`):t.setValue(this.LABELS.dbStatus+(e=="On-line"?`<span style="color: #00BFFF;">${this.LABELS.dbStatusOnline}</span>`:`<span style="color: #ff0000;">${this.LABELS.dbStatusOffline}</span>`)))}_updateLocalModulesInformation(e){if(!e)return;const t=$$(this.NAMES.localModulesTable);if(!t)return;const i=Object.entries(e).map(([o,r])=>({id:o,url:o,version:r.version||"Нет данных",status:r.status||"Нет данных",lastSyncDateTime:r.lastSyncDateTime,isReady:r.isReady,hasSyncError:r.hasSyncError}));t.clearAll(),t.parse(i)}_updateCheckStatistics(e,t){const i=$$(this.NAMES.checkStatisticsTable),o=$$(this.NAMES.checkStatisticsTableLabel);if(!i)return;if(t=="Disabled"){i.hide(),o.hide();return}i.clearAll();const r=[{id:"today",period:this.LABELS.today,totalChecks:e.today.total||0,successfulOnline:e.today.successfulOnline||0,successfulOffline:e.today.successfulOffline||0,successRate:e.today.successRate||0},{id:"last7Days",period:this.LABELS.last7Days,totalChecks:e.last7Days.total||0,successfulOnline:e.last7Days.successfulOnline||0,successfulOffline:e.last7Days.successfulOffline||0,successRate:e.last7Days.successRate||0},{id:"last30Days",period:this.LABELS.last30Days,totalChecks:e.last30Days.total||0,successfulOnline:e.last30Days.successfulOnline||0,successfulOffline:e.last30Days.successfulOffline||0,successRate:e.last30Days.successRate||0}];i.parse(r)}}function V(s){return new F(s).loadConfig().render()}class z{constructor(e){this.formName="MarksView",this.id=e,this.marksApiAddress="/api/marks",this.currentPage=1,this.pageSize=50,this.searchTerm="",this.LABELS={formTitle:"FMU-API: Марки",search:"Поиск по номеру марки",totalMarks:"Всего марок: ",page:"Страница: ",noData:"Нет данных",markId:"Номер марки",state:"Состояние",checkDate:"Дата проверки",onlineCheck:"On-line проверка",offlineCheck:"Off-line проверка"},this.NAMES={toolbarLabel:"toolbarLabel",searchInput:"searchInput",marksTable:"marksTable",paginationInfo:"paginationInfo",prevButton:"prevButton",nextButton:"nextButton"},this._loadMarks()}loadConfig(){return this}render(){$$("toolbarLabel").setValue(this.LABELS.formTitle);var e=[{view:"toolbar",borderless:!0,elements:[{view:"text",id:this.NAMES.searchInput,placeholder:this.LABELS.search,width:300,on:{onTimedKeyPress:()=>this._onSearch()}},{view:"button",value:"Поиск",width:100,click:()=>this._onSearch()},{},{view:"button",id:this.NAMES.prevButton,value:"←",width:50,disabled:!0,click:()=>this._goToPage(this.currentPage-1)},{view:"label",id:this.NAMES.paginationInfo,label:this.LABELS.page+"1",width:150},{view:"button",id:this.NAMES.nextButton,value:"→",width:50,disabled:!0,click:()=>this._goToPage(this.currentPage+1)}]},this._marksTable(),{}],t={view:"form",id:this.id,name:this.formName,disabled:!1,elements:e};return t}_marksTable(){return{id:this.NAMES.marksTable,view:"datatable",columns:[{id:"markId",header:this.LABELS.markId,width:200,sort:"string",fillspace:!0},{id:"state",header:this.LABELS.state,width:120,sort:"string",template:function(e){return`<span style="color: ${{Stock:"#00BFFF",Sold:"#FFA500",Returned:"#FF0000"}[e.state]||"#FFFFFF"};">${e.state}</span>`}},{id:"checkDate",header:this.LABELS.checkDate,width:150,sort:"date"}],autoheight:!0,scroll:!1,select:!1,data:[]}}_paginationControls(){return{view:"toolbar",elements:[{view:"button",id:this.NAMES.prevButton,value:"←",width:50,disabled:!0,click:()=>this._goToPage(this.currentPage-1)},{view:"label",id:this.NAMES.paginationInfo,label:this.LABELS.page+"1",width:150},{view:"button",id:this.NAMES.nextButton,value:"→",width:50,disabled:!0,click:()=>this._goToPage(this.currentPage+1)},{}]}}async _loadMarks(){const e=new URL(this.marksApiAddress,window.location.origin);e.searchParams.set("page",this.currentPage.toString()),e.searchParams.set("pageSize",this.pageSize.toString()),this.searchTerm&&e.searchParams.set("search",this.searchTerm);let t;try{const i=await fetch(e);if(!i.ok)throw new Error(`Ошибка получения данных ${i.status} ${i.statusText}`);t=await i.json()}catch(i){if(i.name==="TypeError"||i.message.includes("fetch")||i.message.includes("Failed to fetch")||i.message.includes("NetworkError")||i.message.includes("ERR_CONNECTION_REFUSED"))return;console.error("Ошибка при загрузке марок:",i),webix.message({text:"Ошибка при загрузке марок",type:"error"})}this._updateMarksTable(t),this._updatePagination(t)}_updateMarksTable(e){const t=$$(this.NAMES.marksTable);if(!t)return;const i=e.marks.map(o=>({id:o.id,markId:o.markId,state:o.state,checkDate:new Date(o.trueApiAnswerProperties.reqTimestamp).toLocaleString(),haveTrueApiAnswer:o.haveTrueApiAnswer}));t.clearAll(),t.parse(i)}_updatePagination(e){const t=$$(this.NAMES.prevButton),i=$$(this.NAMES.nextButton),o=$$(this.NAMES.paginationInfo);t&&(t.enable(),e.currentPage<=1&&t.disable()),i&&(i.enable(),e.currentPage>=e.totalPages&&i.disable()),o&&o.setValue(`${this.LABELS.page}${e.currentPage} из ${e.totalPages} (${this.LABELS.totalMarks}${e.totalCount})`)}_onSearch(){const e=$$(this.NAMES.searchInput);e&&(this.searchTerm=e.getValue()),this.currentPage=1,this._loadMarks()}_goToPage(e){e>=1&&(this.currentPage=e,this._loadMarks())}}function j(s){return new z(s).loadConfig().render()}class G{constructor(){this.router=new S,this.bodyId="body",this.initRoutes()}initRoutes(){this.router.register("config",()=>R),this.router.register("information",()=>D),this.router.register("cdnListInfo",()=>y),this.router.register("logsView",()=>U),this.router.register("monitorView",()=>V),this.router.register("marksView",()=>j)}createMainLayout(){return B({rows:[k("FMU-API"),{cols:[O(Object.values(N),e=>this.router.navigate(e,this.bodyId)),{id:this.bodyId}]}]})}init(){b(),webix.ready(()=>{webix.ui(this.createMainLayout()),this.router.navigate("monitorView","body"),webix.event(window,"resize",()=>{const e=$$("root");$$(this.bodyId),e.$setSize(window.innerWidth,window.innerHeight)})})}}new G().init();function T(s){let e=$$(s);if(e==null)return;let t=e.data.tableId;if(t!=null)return $$(t)}function H(s){let e=T(s);e!=null&&webix.confirm({title:"Вы уверены?",text:"Вы собираетесь полностью очистить таблицу?",ok:"Да",cancel:"Нет"}).then(function(){e.clearAll(),$$(s).disable()})}function W(s,e){let t=T(s);if(t==null)return;let i=t.getSelectedItem();if(i==null){webix.message("Не выбрана строка для удаления!");return}t.remove(i.id)}function q(s,e){let t=T(s);t!=null&&t.add({})}const c={top:5,bottom:5,left:20,right:20};function $(s,e={}){let t={cols:[{view:"button",value:"Добавить",id:`add_${s}`,tableId:s,autowidth:"false",width:400,click:q},{view:"button",value:"Удалить",id:`delete_${s}`,tableId:s,autowidth:"false",width:400,disabled:!0,click:W},{view:"button",value:"Удалить все",id:`deleteAll_${s}`,tableId:s,autowidth:"false",width:400,disabled:!1,click:H},{}]};return L(t,e)}function d(s,e,t={}){return L({view:"label",id:s,label:e},t)}function u(s,e,t,i={}){return L({view:"text",type:"text",value:t,label:s,labelPosition:"top",id:e,name:e},i)}function m(s,e,t,i,o={}){return L({view:"text",type:"number",id:e,name:e,value:t,label:s,labelPosition:"top",format:i},o)}function A(s,e,t={}){return L({view:"text",type:"password",label:s,labelPosition:"top",id:e,name:e},t)}function p(s,e,t={}){return L({view:"checkbox",label:s,labelWidth:"auto",labelPosition:"left",id:e,name:e},t)}function L(s,e){for(let t in e)s[t]=e[t];return s}class Y{constructor(e){this.id=e,this.LABELS={title:"Сервер",name:"Название узла",ipPortApi:"IP-порт API сервиса"}}loadConfig(e){return e!=null&&e.serverConfig&&(this.apiIpPort=e.serverConfig.apiIpPort??2578),e!=null&&e.nodeName&&(this.nodeName=e.nodeName),this}render(){var e=[];return e.push(d("lServerConfig",this.LABELS.title)),e.push({padding:c,rows:[u("Название узла","nodeName",this.nodeName),m("IP-порт API сервиса","serverConfig.apiIpPort",this.apiIpPort,"111")]}),{id:this.id,rows:e}}}function Z(s,e){return new Y(s).loadConfig(e).render()}const K=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));class X{constructor(e){this.id=e,this.SETTINGS_ID="saleControlls",this.LABELS={title:"Контроль при продаже товаров",banSalesReturnedWares:"Блокировать продажу возвращенных товаров",ignoreVerificationErrorForTrueApiGroups:"Коды групп товаров игнорирующик проверку статусов кода маркировки в Честном Знаке",checkIsOwnerField:"Проверять владельца марки",forFrontolMoreThen205:"Настройки для тарифного фронтола (6.21.0 и выше):",checkReceiptReturn:"Проверять товары из чеков возврата",sendEmptyTrueApiAnswerWhenTimeoutError:"Генерировать пустой ответ от честного знака при недоступности cdn",correctExpireDateInReturns:"Исправлять истекший срок годности в чеках возврата",sendLocalModuleInformationalInRequestId:"Отправлять информацию о локальном модуле для тега 1265 в requestId",dateRejectsSalesWithoutCheckData:"Дата отказа в продаже данных проверки (оффлайн режим)",resetSoldStatusForReturn:"Для возвратов - изменять стаус `Проданно` для товаров (тарифный фронтол до 25 версии)"}}loadConfig(e){return e!=null&&e.saleControlConfig&&(this.banSalesReturnedWares=e.saleControlConfig.banSalesReturnedWares,this.ignoreVerificationErrorForTrueApiGroups=e.saleControlConfig.ignoreVerificationErrorForTrueApiGroups,this.checkIsOwnerField=e.saleControlConfig.checkIsOwnerField,this.checkReceiptReturn=e.saleControlConfig.checkReceiptReturn,this.sendEmptyTrueApiAnswerWhenTimeoutError=e.saleControlConfig.sendEmptyTrueApiAnswerWhenTimeoutError,this.correctExpireDateInSaleReturn=e.saleControlConfig.correctExpireDateInSaleReturn,this.sendLocalModuleInformationalInRequestId=e.saleControlConfig.sendLocalModuleInformationalInRequestId,this.rejectSalesWithoutCheckInformationFrom=new Date(e.saleControlConfig.rejectSalesWithoutCheckInformationFrom),this.resetSoldStatusForReturn=e.saleControlConfig.resetSoldStatusForReturn),this}render(){var e=[];return e.push(d("lSalesControlParameters",this.LABELS.title)),e.push({padding:c,rows:[{view:"datepicker",label:this.LABELS.dateRejectsSalesWithoutCheckData,name:"saleControlConfig.rejectSalesWithoutCheckInformationFrom",value:this.rejectSalesWithoutCheckInformationFrom,labelPosition:"top",format:"%Y-%m-%d"},p(this.LABELS.banSalesReturnedWares,"saleControlConfig.banSalesReturnedWares",{value:this.banSalesReturnedWares}),u(this.LABELS.ignoreVerificationErrorForTrueApiGroups,"saleControlConfig.ignoreVerificationErrorForTrueApiGroups",this.ignoreVerificationErrorForTrueApiGroups),p(this.LABELS.checkIsOwnerField,"saleControlConfig.checkIsOwnerField",{value:this.checkIsOwnerField}),p(this.LABELS.correctExpireDateInReturns,"saleControlConfig.correctExpireDateInSaleReturn",{value:this.correctExpireDateInSaleReturn}),p(this.LABELS.sendLocalModuleInformationalInRequestId,"saleControlConfig.sendLocalModuleInformationalInRequestId",{value:this.sendLocalModuleInformationalInRequestId}),d("scForFrontolMoreThen21",this.LABELS.forFrontolMoreThen205),{padding:{left:20},rows:[p(this.LABELS.checkReceiptReturn,"saleControlConfig.checkReceiptReturn",{value:this.checkReceiptReturn}),p(this.LABELS.sendEmptyTrueApiAnswerWhenTimeoutError,"saleControlConfig.sendEmptyTrueApiAnswerWhenTimeoutError",{value:this.sendEmptyTrueApiAnswerWhenTimeoutError}),p(this.LABELS.resetSoldStatusForReturn,"saleControlConfig.resetSoldStatusForReturn",{value:this.resetSoldStatusForReturn})]}]}),{id:this.id,rows:e}}}function J(s,e){return new X(s).loadConfig(e).render()}const Q=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));class ee{constructor(e){this.id=e,this.SETTINGS_ID="minimalPrices",this.LABELS={title:"Минимальные цены",tabaco:"Табак (в копейках 135р = 13500)"}}loadConfig(e){return e!=null&&e.saleControlConfig&&(this.tabaco=e.minimalPrices.tabaco),this}render(){var e=[];return e.push(d("lMinimalPrices",this.LABELS.title)),e.push({padding:c,rows:[m(this.LABELS.tabaco,"minimalPrices.tabaco",this.tabaco,"1111")]}),{id:this.id,rows:e}}}function te(s,e){return new ee(s).loadConfig(e).render()}const se=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));class ie{constructor(e){this.id=e,this.formName="OrganisationForm",this.LABELS={title:"Организации",newOrg:"Новая организация",editOrg:"Организация",code:"Код организации (группы печати), если группы печати не используются, то все равно код должен быть 1",inn:"ИНН организации",name:"Наименование",xapikey:"X-API key",add:"Сохранить",close:"Закрыть",enable:"Используется",connectionAddress:"Адрес подключения",userName:"Имя пользователя",password:"Пароль",localModuleStatus:"Статус ЛМ",LocalModuleTitle:"Локальный модуль Честного знака",localModuleStatusTitle:"Статус локального модуля",localModuleInit:"Инициализация ЛМ"},this.LOCAL_MODULE_STATUS={NOT_CONFIGURED:0,INITIALIZATION:1,READY:2,SYNC_ERROR:3,UNKNOWN:4},this.LOCAL_MODULE_STATUS_DISPLAY={[this.LOCAL_MODULE_STATUS.NOT_CONFIGURED]:{text:"Не настроен",color:"#FFA500"},[this.LOCAL_MODULE_STATUS.INITIALIZATION]:{text:"Инициализация",color:"#3498DB"},[this.LOCAL_MODULE_STATUS.READY]:{text:"Готов к работе",color:"#2ECC71"},[this.LOCAL_MODULE_STATUS.SYNC_ERROR]:{text:"Ошибка синхронизации",color:"#E74C3C"},[this.LOCAL_MODULE_STATUS.UNKNOWN]:{text:"Неизвестный статус",color:"#E74C3C"}},this.POLL_INTERVAL=1e4,this._startLocalModuleStatusPolling()}_getStatusDisplay(e){return this.LOCAL_MODULE_STATUS_DISPLAY[e]||{text:"Неизвестный статус",color:"#95A5A6"}}loadConfig(e){return e&&e.organisationConfig&&e.organisationConfig.printGroups&&(this.printGroups=e.organisationConfig.printGroups.map(t=>({...t,localModuleStatus:this.LOCAL_MODULE_STATUS.NOT_CONFIGURED}))),this}render(){var e=[];e.push(d("lOrganizations",this.LABELS.title));const t=$("PrintGroups");return t.cols.splice(t.cols.length-1,0,{view:"button",value:this.LABELS.localModuleInit,id:"initLm_PrintGroups",disabled:!0,tableId:"PrintGroups",autowidth:!1,width:200,tooltip:"Инициализация локального модуля",click:()=>this._initializeLocalModule()}),e.push({padding:c,name:"organisationConfig",rows:[t,this._createFormTable()]}),{id:this.id,rows:e}}_createFormTable(){return{view:"formtable",id:"PrintGroups",name:"organisationConfig.printGroups",data:this.printGroups,resizeColumn:!0,resizeRow:!0,select:!0,minHeight:250,columns:[{id:"id",header:this.LABELS.code},{id:"name",header:this.LABELS.name,fillspace:!0},{id:"xapikey",header:this.LABELS.xapikey,fillspace:!0},{id:"localModuleStatus",header:this.LABELS.localModuleStatusTitle,fillspace:!0,template:e=>{const t=this._getStatusDisplay(e.localModuleStatus);return`<div style="
                            color: ${t.color}; 
                            font-weight: bold; 
                            text-align: center;
                            padding: 2px 5px;
                            border-radius: 3px;
                            background: ${t.color}15;
                        ">
                            ${t.text}
                        </div>`}}],on:{onAfterSelect:e=>{$$("delete_PrintGroups").enable(),this._updateInitButtonState()},onAfterDelete:e=>{$$("delete_PrintGroups").disable(),$$("PrintGroups").count()==0&&$$("deleteAll_PrintGroups").disable()},onBeforeAdd:(e,t)=>{if(t.xapikey==null)return this.showForm(this.LABELS.newOrg,"PrintGroups"),!1},onItemDblClick:e=>{this.showForm(this.LABELS.editOrg,"PrintGroups",e)}}}}showForm(e,t,i){const o=window.innerWidth;webix.ui({view:"window",id:this.formName,position:"center",modal:!0,move:!1,resize:!1,width:o*.8,head:this._createFormHeader(e),body:this._createFormBody(t,i)}).show(),this._initFormValues(t,i)}_createFormHeader(e){return{view:"toolbar",elements:[{view:"label",label:e},{view:"icon",icon:"wxi-close",click:()=>$$(this.formName).close()}]}}_createFormBody(e,t){return{padding:10,rows:[m(this.LABELS.code,"OrganizationId","1111"),u(this.LABELS.name,"OrganizationName"),u(this.LABELS.inn,"OrganizationInn"),u(this.LABELS.xapikey,"XAPIKEY"),d("LocalModuleTitle",this.LABELS.LocalModuleTitle),p(this.LABELS.enable,"LocalModuleEnable"),u(this.LABELS.connectionAddress,"LocalModuleConnectionAddress","",{placeholder:"http://hostname:5995"}),u(this.LABELS.userName,"LocalModuleUserName"),A(this.LABELS.password,"LocalModulePassword"),{padding:{top:10},cols:[{view:"button",value:this.LABELS.add,id:"addButton",autowidth:"false",width:400,click:()=>this._handleAddButton(e,t)},{view:"button",value:this.LABELS.close,id:"closeBtn",autowidth:"false",width:400,click:()=>$$(this.formName).close()},{}]}]}}_handleAddButton(e,t){let i=$$("OrganizationId").getValue();if(i=="")return;let o=$$(e);if(o==null)return;if(o.find(l=>l.id==i&&i!=t).length>0){webix.message({text:"Организация с таким кодом уже есть в списке!",type:"error"});return}const n={id:i,xapikey:$$("XAPIKEY").getValue(),inn:$$("OrganizationInn").getValue(),name:$$("OrganizationName").getValue(),localModuleConnection:{enable:$$("LocalModuleEnable").getValue(),connectionAddress:$$("LocalModuleConnectionAddress").getValue(),userName:$$("LocalModuleUserName").getValue(),password:$$("LocalModulePassword").getValue()}};t==null?o.add(n):o.updateItem(t,n),o.count()>0&&$$("deleteAll_PrintGroups").enable(),$$(this.formName).close(),this._saveConfiguration(),this._updateInitButtonState()}_saveConfiguration(){I("body")}_initFormValues(e,t){let i=$$(e);if(t==null){let r=i.getLastId();$$("OrganizationId").setValue(r==null?1:r+1);return}let o=i.getItem(t);$$("OrganizationId").setValue(o.id),$$("OrganizationId").disable(),$$("OrganizationInn").setValue(o.inn),$$("OrganizationName").setValue(o.name),$$("LocalModuleEnable").setValue(o.localModuleConnection.enable),$$("LocalModuleConnectionAddress").setValue(o.localModuleConnection.connectionAddress),$$("LocalModuleUserName").setValue(o.localModuleConnection.userName),$$("LocalModulePassword").setValue(o.localModuleConnection.password),$$("XAPIKEY").setValue(o.xapikey)}_startLocalModuleStatusPolling(){const e=this.POLL_INTERVAL,t=async()=>{try{const o=await fetch("/api/lm/state");if(!o.ok)throw new Error("Ошибка получения статусов");const r=await o.json(),n=$$("PrintGroups");if(!n)return;r.forEach(l=>{const f=n.getItem(l.organization);if(f){if(f.localModuleStatus==l.status)return;const E={...f,localModuleStatus:l.status};n.updateItem(l.organization,E),this._updateInitButtonState()}})}catch(o){if(o.name==="TypeError"||o.message.includes("fetch")||o.message.includes("Failed to fetch")||o.message.includes("NetworkError")||o.message.includes("ERR_CONNECTION_REFUSED"))return;console.error("Ошибка при получении статусов ЛМ:",o)}};t();const i=setInterval(t,e);this.on_destroy=()=>{clearInterval(i)}}_updateInitButtonState(){const e=$$("PrintGroups").getSelectedId(),t=$$("initLm_PrintGroups");if(!e||!t)return;const o=$$("PrintGroups").getItem(e).localModuleConnection;o.enable&&o.connectionAddress&&o.userName&&o.password?t.enable():t.disable()}_initializeLocalModule(){const e=$$("PrintGroups").getSelectedId();if(!e){webix.message({text:"Выберите организацию для инициализации локального модуля",type:"warning"});return}const i=$$("PrintGroups").getItem(e);if(i.localModuleConnection.enable){if(i.localModuleStatus===this.LOCAL_MODULE_STATUS.NOT_CONFIGURED){this._startInitialization(e,i);return}if(i.localModuleStatus!=this.LOCAL_MODULE_STATUS.READY){webix.message({text:`В этом статусе ЛМ ${this.LOCAL_MODULE_STATUS_DISPLAY[i.localModuleStatus].text} нельзя выполнять инициализацию!`,type:"warning"});return}webix.confirm({title:"Инициализация локального модуля",text:`Выполнить повторную инициализацию локального модуля для организации "${i.name}"?`,ok:"Да",cancel:"Отмена",callback:o=>{o&&this._startInitialization(e,i)}})}}_startInitialization(e,t){const i=$$("PrintGroups"),o={...t,localModuleStatus:this.LOCAL_MODULE_STATUS.INITIALIZATION};i.updateItem(e,o),fetch(`/api/lm/init/${e}`,{method:"POST"}).catch(r=>{console.error("Ошибка при отправке запроса инициализации:",r),webix.message({text:"Ошибка при отправке запроса инициализации",type:"error"})}),webix.message({text:"Запущена инициализация локального модуля",type:"info"})}}function oe(s,e){return new ie(s).loadConfig(e).render()}const re=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));class ae{constructor(e){this.id=e,this.formName="HostToPingForm",this.LABELS={title:"Адреса сайтов для проверки доступности интернета (если проверка не нужна, то список должен быть пустым)",newHost:"Новый сайт",editHost:"Сайт",hostNameHint:"название сайта без https, например: au124.ru",add:"Сохранить",close:"Закрыть",existError:"Этот сайт уже есть в списке!"}}loadConfig(e){return e&&e.hostsToPing&&(this.hostsToPing=e.hostsToPing),this}render(){var e=[];return e.push(d("lHostsToPing",this.LABELS.title)),e.push({padding:c,rows:[$("HostsToPing"),this._createFormTable()]}),{id:this.id,rows:e}}_createFormTable(){return{view:"formtable",id:"HostsToPing",name:"hostsToPing",data:this.hostsToPing,resizeColumn:!0,resizeRow:!0,select:!0,minHeight:250,columns:[{id:"id",header:"Код",hidden:!0},{id:"value",header:"Хост",fillspace:!0}],on:{onAfterSelect:()=>{$$("delete_HostsToPing").enable()},onAfterDelete:()=>{$$("delete_HostsToPing").disable(),$$("HostsToPing").count()==0&&$$("deleteAll_HostsToPing").disable()},onBeforeAdd:(e,t)=>{if(t.value==null)return this.showForm(this.LABELS.newHost,"HostsToPing"),!1},onItemDblClick:e=>{this.showForm(this.LABELS.editHost,"HostsToPing",e)}}}}showForm(e,t,i){const o=window.innerWidth;webix.ui({view:"window",id:this.formName,position:"center",modal:!0,move:!1,resize:!1,width:o*.8,head:this._createFormHeader(e),body:this._createFormBody(t,i)}).show(),this._initFormValues(t,i),$$("HostName").focus()}_createFormHeader(e){return{view:"toolbar",elements:[{view:"label",label:e},{view:"icon",icon:"wxi-close",click:()=>$$(this.formName).close()}]}}_createFormBody(e,t){return{rows:[u(this.LABELS.hostNameHint,"HostName",""),m("id hidden","Id","","1111",{hidden:!0}),{cols:[{view:"button",value:this.LABELS.add,id:"addButton",autowidth:"false",width:400,click:()=>this._handleAddButton(e,t)},{view:"button",value:this.LABELS.close,id:"closeBtn",autowidth:"false",width:400,click:()=>$$(this.formName).close()},{}]}]}}_handleAddButton(e,t){let i=$$("HostName").getValue();if(!i)return;let o=$$(e);if(!o)return;if(o.find(n=>n.value.toLowerCase()==i&&n.id!=t).length>0){webix.message({text:this.LABELS.existError,type:"error"});return}if(t==null){let n=o.getLastId(),l=n==null?1:n+1;o.add({value:i,id:l})}else o.updateItem(t,{value:i,id:t});o.count()>0&&$$("deleteAll_HostsToPing").enable(),$$(this.formName).close()}_initFormValues(e,t){if(t!=null){let o=$$(e).getItem(t);$$("HostName").setValue(o.value),$$("Id").setValue(o.id)}}}function ne(s,e){return new ae(s).loadConfig(e).render()}const le=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),g={WINDOWS_PATH:"windowsPath",HTTP_ADDRESS:"httpAddress",HOSTNAME:"hostname",COUCH_DB:"couchDb",FRONTOL_DB:"frontolDb"};class de{constructor(e,t,i){this.type=e,this.validate=o=>o==null?!1:t(String(o)),this.message=i}toWebix(){return{validate:this.validate,invalidMessage:this.message,on:{onBlur:function(){this.validate()}}}}}const w=(s,e,t)=>new de(s,e,t),ue=w(g.WINDOWS_PATH,s=>!s||s.length>260?!1:/^([a-zA-Z]:\\[^<>:"/\\|?*]+\\?)$|^(\\\\[^<>:"/\\|?*]+\\[^<>:"/\\|?*]+\\?)$/.test(s),"Введите корректный путь к каталогу Windows"),ce=w(g.HTTP_ADDRESS,s=>s==""?!0:!s||s.length>2083?!1:/^https?:\/\/[a-zA-Z0-9.-]+(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/.test(s),"Адрес должен быть в формате http(s)://hostname[:port]"),he=w(g.FRONTOL_DB,s=>{if(s=="")return!0;let e=s.indexOf(":");if(e===-1)return!1;let t=s.substring(0,e),i=s.substring(e+1);if(/^\d+:/.test(i)){let o=i.indexOf(":"),r=i.substring(0,o);if(i=i.substring(o+1),!/^\d+$/.test(r))return!1}return!t||/[\\/:*?"<>|]/.test(t)?!1:i.startsWith("/")?i.length>1:/^[A-Za-z]:\\/.test(i)?!0:/^[^\\/:*?"<>|]+$/.test(i)},"Путь должен быть указан как 'ИМЯ_СЕРВЕРА:ПУТЬ_К_БАЗЕ_НА_СЕРВЕРЕ'"),pe=w(g.COUCH_DB,s=>s==""?!0:/^[a-z][a-z0-9_$()+-/]*$/.test(s),"Допустимы только строчные латинские буквы, цифры и символы _$()+-/"),fe=w(g.HOSTNAME,s=>s==""?!0:/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(s),"Адрес должен быть в формате domain.tld (например: au124.ru)"),me=ue.toWebix(),v=ce.toWebix(),be=he.toWebix();pe.toWebix(),fe.toWebix();class Se{constructor(e){this.id=e,this.SETTINGS_ID="databaseConnection",this.LABELS={title:"База данных",enable:"Использовать",serverDbAddress:"Адрес сервера CouchDb",user:"Пользователь",password:"Пароль",bulkBatchSize:"Размер пакета",bulkParallelTasks:"Количество параллельных задач",bulkLabel:"Параметры пакетной обработки"}}loadConfig(e){return e!=null&&e.logging&&(this.serverDbAddress=e.database.netAddress,this.userName=e.database.userName,this.userPassword=e.database.password,this.enable=e.database.enable,this.bulkBatchSize=e.database.bulkBatchSize,this.bulkParallelTasks=e.database.bulkParallelTasks),this}render(){var e=[];return e.push(d("lDatabaseConfig",this.LABELS.title)),e.push({padding:c,rows:[p(this.LABELS.enable,"database.enable",{value:this.enable,on:{onChange:t=>{t?$$(this.SETTINGS_ID).enable():$$(this.SETTINGS_ID).disable()}}}),{id:this.SETTINGS_ID,disabled:!this.enable,rows:[u(this.LABELS.serverDbAddress,"database.netAddress",this.serverDbAddress,v),{cols:[u(this.LABELS.user,"database.userName",this.userName),A(this.LABELS.password,"database.password",{value:this.userPassword})]},d("lBulkConfig",this.LABELS.bulkLabel),{padding:c,cols:[m(this.LABELS.bulkBatchSize,"database.bulkBatchSize",this.bulkBatchSize),m(this.LABELS.bulkParallelTasks,"database.bulkParallelTasks",this.bulkParallelTasks)]}]}]}),e.push({view:"button",id:"fauxton_open",value:"Открыть Fauxton",inputWidth:180,inputHeight:40,click:t=>{let i=$$("database.netAddress").getValue();i!=""&&window.open(`${i}/_utils`,"_blank").focus()}}),{id:this.id,rows:e}}}function Le(s,e){return new Se(s).loadConfig(e).render()}const ge=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));class we{constructor(e){this.id=e,this.SETTINGS_ID="frontolDatabaseConnection",this.LABELS={title:"Настройка подключения к базе Frontol (для получения группы печати)",maingdbPath:"Путь к файлу main.gdb",user:"Имя пользователя firebird",password:"Пароль пользователя firebird"}}loadConfig(e){return e!=null&&e.frontolAlcoUnit&&(this.maingdbPath=e.frontolConnectionSettings.path,this.user=e.frontolConnectionSettings.userName,this.password=e.frontolConnectionSettings.password),this}render(){var e=[];return e.push(d("lFrontolConnection",this.LABELS.title)),e.push({padding:c,rows:[u(this.LABELS.maingdbPath,"frontolConnectionSettings.path",this.maingdbPath,be),u(this.LABELS.user,"frontolConnectionSettings.UserName",this.user,{placeholder:"SYSDBA"}),A(this.LABELS.password,"frontolConnectionSettings.password",{value:this.password})]}),{id:this.id,rows:e}}}function Ae(s,e){return new we(s).loadConfig(e).render()}const Ee=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));class _e{constructor(e){this.id=e,this.SETTINGS_ID="markUnitConnection",this.LABELS={title:"Настройка подключения к MarkUnit",addres:"Адрес",user:"Имя пользователя",password:"Пароль"}}loadConfig(e){return e!=null&&e.frontolAlcoUnit&&(this.addres=e.frontolAlcoUnit.netAdres,this.user=e.frontolAlcoUnit.userName,this.password=e.frontolAlcoUnit.password),this}render(){var e=[];return e.push(d("lMarkUnit",this.LABELS.title)),e.push({padding:c,rows:[u(this.LABELS.addres,"frontolAlcoUnit.netAdres",this.addres,v),u(this.LABELS.user,"frontolAlcoUnit.UserName",this.user),A(this.LABELS.password,"frontolAlcoUnit.password",{value:this.password})]}),{id:this.id,rows:e}}}function Te(s,e){return new _e(s).loadConfig(e).render()}const ve=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));class Ie{constructor(e){this.id=e,this.SETTINGS_ID="tokenService",this.LABELS={title:"Сервис получения токена для авторизации в Честном знаке",address:"Адрес",enable:"Использовать"}}loadConfig(e){return e!=null&&e.trueSignTokenService&&(this.address=e.trueSignTokenService.connectionAddress,this.enable=e.trueSignTokenService.enable),this}render(){var e=[];return e.push(d("lTrueSignService",this.LABELS.title)),e.push({padding:c,rows:[p(this.LABELS.enable,"trueSignTokenService.enable",{value:this.enable,on:{onChange:t=>{t?$$(this.SETTINGS_ID).enable():$$(this.SETTINGS_ID).disable()}}}),{id:this.SETTINGS_ID,disabled:!this.enable,rows:[u("Адрес","trueSignTokenService.connectionAddress",this.address,v)]}]}),{id:this.id,rows:e}}}function Ce(s,e){return new Ie(s).loadConfig(e).render()}const $e=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));class Pe{constructor(e){this.id=e,this.SETTINGS_ID="timeoutsSettings",this.LABELS={title:"Таймауты",cdnLoadTimeout:"Загрузка списка cdn, сек",checkRequestTimeout:"Проверка марки в ЧЗ, сек",checkInternetConnectionTimeout:"Проверка доступа в интернет, сек"}}loadConfig(e){return e!=null&&e.httpRequestTimeouts&&(this.cdnLoadTimeout=e.httpRequestTimeouts.cdnRequestTimeout,this.checkRequestTimeout=e.httpRequestTimeouts.checkMarkRequestTimeout,this.checkInternetConnectionTimeout=e.httpRequestTimeouts.checkInternetConnectionTimeout),this}render(){var e=[];return e.push(d("lTimeoutConfig",this.LABELS.title)),e.push({padding:c,rows:[m(this.LABELS.cdnLoadTimeout,"httpRequestTimeouts.cdnRequestTimeout",this.cdnLoadTimeout,"1111"),m(this.LABELS.checkRequestTimeout,"httpRequestTimeouts.checkMarkRequestTimeout",this.checkRequestTimeout,"1111"),m(this.LABELS.checkInternetConnectionTimeout,"httpRequestTimeouts.checkInternetConnectionTimeout",this.checkInternetConnectionTimeout,"1111")]}),{id:this.id,rows:e}}}function Be(s,e){return new Pe(s).loadConfig(e).render()}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));class Oe{constructor(e){P(this,"LOG_LEVELS",["Verbose","Debug","Information","Warning","Error","Fatal"]);this.id=e,this.SETTINGS_ID="loggingSettings",this.LABELS={title:"Логирование",enabled:"Использовать",depth:"Сколько дней хранить файлы лога",level:"Уровень логирования"}}loadConfig(e){return e!=null&&e.logging&&(this.enabled=e.logging.isEnabled,this.level=e.logging.logLevel,this.depth=e.logging.logDepth),this}render(){var e=[];return e.push(d("lLoggingConfig",this.LABELS.title)),e.push({padding:c,rows:[p(this.LABELS.enabled,"logging.isEnabled",{value:this.enabled,on:{onChange:t=>{t?$$(this.SETTINGS_ID).enable():$$(this.SETTINGS_ID).disable()}}}),{id:this.SETTINGS_ID,disabled:!this.enabled,rows:[m(this.LABELS.depth,"logging.logDepth",this.depth,"1111"),{view:"select",label:this.LABELS.level,labelPosition:"top",id:"LogLevel",name:"logging.logLevel",options:this.LOG_LEVELS,value:this.level}]}]}),{id:this.id,rows:e}}}function Ne(s,e){return new Oe(s).loadConfig(e).render()}const Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));class De{constructor(e){this.id=e,this.SETTINGS_ID="autoUpdateSettings",this.LABELS={title:"Автоматическое обновление",enabled:"Использовать",catalog:"Каталог с файлами обновления",hours:"Часы для автоматического обновления",fileNameDescription:"служба ищет в указанном каталоге архив update.zip",timeIntervalDescription:"если правая граница интервала 23:59, то ставьте значение 00"},this.HOURS_COUNT=24,this.TIME_COMBO_WIDTH=60}createHoursOptions(){return Array.from({length:this.HOURS_COUNT},(e,t)=>({id:t+1,value:t.toString().padStart(2,"0")}))}timeComboBox(e,t,i=1){return{view:"combo",id:e,name:t,value:i,options:this.createHoursOptions(),maxWidth:this.TIME_COMBO_WIDTH,format:"02",newValues:!1}}loadConfig(e){var o,r;if(e!=null&&e.autoUpdate){this.enabled=e.autoUpdate.enabled??!1,this.updateFilesCatalog=e.autoUpdate.updateFilesCatalog??"";var t=parseInt((o=e==null?void 0:e.autoUpdate)==null?void 0:o.fromHour);t=t<=0?1:t;var i=parseInt((r=e==null?void 0:e.autoUpdate)==null?void 0:r.untilHour);i=i<=0?24:i,this.fromHour=t-1||0,this.untilHour=i-1||0}return this}render(){var e=[];return e.push(d("lAutoUpdateLabel",this.LABELS.title)),e.push({padding:c,rows:[p(this.LABELS.enabled,"autoUpdate.enabled",{value:this.enabled,on:{onChange:t=>{t?$$(this.SETTINGS_ID).enable():$$(this.SETTINGS_ID).disable()}}}),{id:this.SETTINGS_ID,disabled:!this.enabled,rows:[u(this.LABELS.catalog,"autoUpdate.updateFilesCatalog",this.updateFilesCatalog,me),d("fileNameDescription",this.LABELS.fileNameDescription,{css:{"font-style":"italic","font-size":"smaller"}}),d("lAutoUpdateHours",this.LABELS.hours),{padding:{left:20},cols:[this.timeComboBox("fromHour","autoUpdate.fromHour",this.fromHour+1),d("AutoUpdateTimeSeparator","-",{maxWidth:5}),this.timeComboBox("untilHour","autoUpdate.untilHour",this.untilHour+1),{}]},d("timeIntervalDescription",this.LABELS.timeIntervalDescription,{css:{"font-style":"italic","font-size":"smaller"}})]}]}),{id:this.id,rows:e}}}function Me(s,e){return new De(s).loadConfig(e).render()}const ye=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}))})();
